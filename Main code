import pygame
import numpy as np
from scipy.io.wavfile import write
import os

class MusicGenerator:
    def __init__(self):
        pygame.mixer.init()
        self.base_freq = 440
        
    def generate_calming_tones(self, stress_level):
        duration = 5
        sample_rate = 44100
        t = np.linspace(0, duration, int(sample_rate * duration))
        
        freq = self.base_freq * (1 - stress_level * 0.3)
        
        waveform = np.sin(2 * np.pi * freq * t)
        
        for i in range(2, 5):
            waveform += 0.3 / i * np.sin(2 * np.pi * freq * i * t)
        
        waveform = np.int16(waveform * 32767)
        
        write("temp_music.wav", sample_rate, waveform)
        
        return "temp_music.wav"
    
    def play_music(self, filename):
        pygame.mixer.music.load(filename)
        pygame.mixer.music.play()
        
    def cleanup(self):
        if os.path.exists("temp_music.wav"):
            os.remove("temp_music.wav")
